FROM node:18-alpine

ARG NODE_ENV=production
ENV NODE_ENV=$NODE_ENV

ARG PORT=3003
ENV PORT=$PORT

ARG CORS_WHITELIST_ORIGINS="*"
ENV CORS_WHITELIST_ORIGINS=$CORS_WHITELIST_ORIGINS

ARG ENCRYPT_SECRET_KEY="SECRET_KEY$"
ENV ENCRYPT_SECRET_KEY=$ENCRYPT_SECRET_KEY

ARG ENCRYPT_SECRET_IV="SECRET_IV$"
ENV ENCRYPT_SECRET_IV=$ENCRYPT_SECRET_IV

ARG MONGO_URL="mongodb://mongo/daily_planner"
ENV MONGO_URL=$MONGO_URL

WORKDIR /user/src/app
COPY . .
RUN npm run build
USER node
CMD ["npm", "run", "start:prod"]
